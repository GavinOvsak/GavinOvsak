<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<title>Food Dashboard</title>

<script src="./res/js/jquery-2.2.4.js"></script>
<script src="./res/js/popper.min.js"></script>
<script src="./res/js/bootstrap.min.js"></script>
<script src="./res/js/awesomplete.js"></script>
<script src="./res/js/lodash.min.js"></script>
<script src="./res/js/jsonpg.js"></script>
<script src="./res/js/utilities.js"></script>
<script src="./res/js/arrayManip.js"></script>

<link rel="stylesheet" href="./res/css/bootstrap.min.css">
<link rel="stylesheet" href="./res/css/awesomplete.css"></link>
<link rel="stylesheet" href="./res/css/jquery-ui.css">
<link rel="stylesheet" href="./res/css/font-awesome.css">
<link rel="preload" href="./res/css/fontawesome-webfont.woff" as="font" type="font/woff">

<link href="./res/css/datepicker.css" rel="stylesheet" type="text/css">
<script src="./res/js/datepicker.min.js"></script>
<script src="./res/js/datepicker.en.js"></script>

<style>
  .tab {
    margin-bottom: 10px;
    margin-top: 10px;
    text-align: center;
    max-width: 120px;
    cursor: pointer;
    display: inline-block;
  }

  .tabText {
    position: relative;
    display: inline-block;
    font-weight: 400;
    text-align: center;
  }

  .custom-underline,
  .custom-underline:hover,
  .custom-underline:focus,
  .custom-underline:active {
    text-decoration: none;
  }

  .custom-underline::after {
    content: "";
    position: absolute;
  }

  .custom-underline::after {
    height: 3px;
    bottom: -7px;
    width: 120%;
    left: -10%;
    background-color: #46a44f;
  }

  .custom-underline-black::after {
    bottom: -7px;
    width: 120%;
    left: -10%;
    background-color: black;
  }

  .custom-underline-red::after {
    bottom: -7px;
    width: 120%;
    left: -10%;
    background-color: red;
  }
  .custom-underline-red {
    color: red;
  }

  .custom-underline-blue::after {
    bottom: -7px;
    width: 120%;
    left: -10%;
    background-color: #1212b1;
  }
  .custom-underline-blue {
    color: #1212b1;
  }

  .custom-underline-green::after {
    bottom: -7px;
    width: 120%;
    left: -10%;
    background-color: green;
  }
  .custom-underline-green {
    color: green;
  }

  .custom-underline-orange::after {
    bottom: -7px;
    width: 120%;
    left: -10%;
    background-color: #ff8400;
  }
  .custom-underline-orange {
    color: #ff8400;
  }

  
</style>

</head>
<body style="">
  <style>
    .amtInput {
      width: 60px; 
      display: inline-block;
      padding-top: 5px;
      padding-left: 8px;
      padding-bottom: 5px;
      padding-right: 5px;
      margin-bottom: 8px;
      height: 35px;
    }

    .foodRow {
      width: calc(100% - 10px);
      background-color: #d7d7d7;
      border-radius: 5px;
      margin-top: 12px;
      margin-right: 10px;
      padding-top: 10px;
      padding-right: 10px;
      padding-left: 10px;
    }

    .mealRow {
      width: calc(100% - 10px);
      background-color: #d7d7d7;
      border-radius: 5px;
      margin-top: 12px;
      padding: 10px;
      margin-right: 10px;
    }

    .goalRow {
      width: calc(100% - 10px);
      background-color: #d7d7d7;
      border-radius: 5px;
      margin-top: 8px;
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 10px;
      margin-bottom: 8px;
    }
  </style>
  <script>
    var food = {};
    var meals = {};
    var groceryCart = {};

    var tab = 'food'; //food, meals, grocery
    var mealType = 'all';
    var day = 1000 * 60 * 60 * 24;
    var foodQuery = '';
    var mealQuery = '';
    var groceryMode = 'buy'; // buy / goals

    var foodId = null;
    var mealId = null;
    var editFoodObj = {};
    var editMealObj = {};
    var editObj = {};
    var editMode = 'remove';

    var today = new Date();
    var date = new Date((today.getMonth() + 1) + '/' + today.getDate() + '/' + (today.getYear() + 1900));

    var foodUpdateCallback = null;
    var updateFood = function(fId) {
      jsonpg.set('gavinovsak.food.food.'+fId, food[fId]);
    };

    var mealUpdateCallback = null;
    var updateMeal = function(mId) {
      jsonpg.set('gavinovsak.food.meals.'+mId, meals[mId]);
    };

    var updateCart = function(mId) {
      jsonpg.set('gavinovsak.food.groceryCart', groceryCart);
    };

    var openModal = function(modalId) {
      if (editingInput) return;
      ['#editModal', '#mealModal', '#foodModal'].map(function(id) {
        if (id != modalId) $(id).modal('hide');
      });
      $(modalId).modal('show');
      setTimeout(function() {
        setMaxHeight(modalId);
      }, 200);
    };

    var refreshFoodModal = function() {
      var item = editFoodObj;

      if (item == null) return $('#foodModal').modal('hide');

      $('#foodName, #foodCost, #foodPackAmount, #foodExpireDays, #foodStore, #foodExpireDaysAfterOpened').val('');

      if(!$('#foodName').is(':focus')) $('#foodName').val(item.name);
      $('#foodName').unbind('input').on('input', function() {
        editFoodObj.name = $(this).val().trim();
        $('#foodModalTitle').text(editFoodObj.name.length > 0 ? ('Edit ' + editFoodObj.name) : 'Edit Food');
      });

      $('#foodModalTitle').text(editFoodObj.name.length > 0 ? ('Edit ' + editFoodObj.name) : 'Edit Food');

      if(!$('#foodCost').is(':focus')) $('#foodCost').val(item.cost);
      $('#foodCost').unbind('input').on('input', function() {
        var cost = parseFloat($(this).val())
        if (isNaN(cost) || cost < 0) return;
        editFoodObj.cost = roundToDecimals(cost, 2);
      });

      if(!$('#foodPackAmount').is(':focus')) $('#foodPackAmount').val(item.packAmount);
      $('#foodPackAmount').unbind('input').on('input', function() {
        var packAmount = parseInt($(this).val());
        if (isNaN(packAmount) || packAmount < 0) return;
        editFoodObj.packAmount = packAmount;
        if (packAmount == 0) delete editFoodObj.packAmount;
      });

      if(!$('#foodExpireDays').is(':focus')) $('#foodExpireDays').val(item.expireDays);
      $('#foodExpireDays').unbind('input').on('input', function() {
        var expireDays = parseInt($(this).val())
        if (isNaN(expireDays) || expireDays < 0) return;
        editFoodObj.expireDays = expireDays;
        if (expireDays == 0) delete editFoodObj.expireDays;
      });

      if(!$('#foodStore').is(':focus')) $('#foodStore').val(item.store);
      $('#foodStore').unbind('input').on('input', function() {
        editFoodObj.store = $(this).val();
      });

      if(!$('#foodExpireDaysAfterOpened').is(':focus')) $('#foodExpireDaysAfterOpened').val(item.expireDaysAfterOpen);
      $('#foodExpireDaysAfterOpened').unbind('input').on('input', function() {
        var expireDaysAfterOpen = parseInt($(this).val())
        if (isNaN(expireDaysAfterOpen) || expireDaysAfterOpen < 0) return;
        editFoodObj.expireDaysAfterOpen = expireDaysAfterOpen;
        if (expireDaysAfterOpen == 0) delete editFoodObj.expireDaysAfterOpen;
      });

      var foodInMeals = keys(meals).filter(function(mId) {
        var mealItem = meals[mId];
        return mealItem.food[editFoodObj.id] != null;
      })
      $('#foodInMealTitle').toggle(foodInMeals.length > 0);

      $('#foodInMealList').empty();
      foodInMeals.map(function(mId) {
        var mealItem = meals[mId];
        $('#foodInMealList').append($(''+
          '<div data-id="'+mId+'" style="background-color: lightgrey; padding: 5px; margin-top: 10px; border-radius: 5px;" class="mealEdit">'+
            '<h6 style="display: inline-block;margin: 5px;">'+mealItem.name+'</h6>'+
            '<span class="icon-arrow-right" style="float: right; font-size: 20px; margin: 5px;"></span>'+
          '</div>'));
      });

      $('.mealEdit').unbind('click').click(function() {
        mealId = getProp(this, 'id');
        editMealObj = clone(meals[mealId]);
        refreshMealModal();
        openModal('#mealModal');
      });

      $('#foodOpenedAsPackSection').toggle(item.packAmount != null && item.expireDaysAfterOpen != null);
      $('.foodOpenedAsPack').addClass('btn-light').removeClass('btn-success');
      $('.foodOpenedAsPack[data-type="'+(item.openInPack ? 'Yes' : 'No')+'"]').removeClass('btn-light').addClass('btn-success');
      $('.foodOpenedAsPack').unbind('click').click(function() {
        var openInPack = getProp(this, 'type');
        if (openInPack == 'Yes') editFoodObj.openInPack = openInPack;
        else delete editFoodObj.openInPack;
        refreshFoodModal();
      });
    };

    var refreshMealModal = function() {
      var item = editMealObj;
      if (item == null) return $('#mealModal').modal('hide');

      $('#mealName, #mealServes, #mealStock, #mealNotes, #mealContentAddSection').val('');

      if(!$('#mealName').is(':focus')) $('#mealName').val(item.name);
      $('#mealName').unbind('input').on('input', function() {
        editMealObj.name = $(this).val();
        $('#mealModalTitle').text(editMealObj.name.length > 0 ? ('Edit ' + editMealObj.name) : 'Edit Meal');
      });

      $('#mealModalTitle').text(editMealObj.name.length > 0 ? ('Edit ' + editMealObj.name) : 'Edit Meal');

      if(!$('#mealServes').is(':focus')) $('#mealServes').val(item.serves);
      $('#mealServes').unbind('input').on('input', function() {
        var serves = parseInt($(this).val())
        if (isNaN(serves) || serves < 0) return;
        editMealObj.serves = serves;
      });

      if(!$('#mealStock').is(':focus')) $('#mealStock').val(item.stock == 0 ? '' : item.stock);
      $('#mealStock').unbind('input').on('input', function() {
        var stock = parseInt($(this).val())
        if ($(this).val().trim().length == 0) editMealObj.stock = 0;
        if (isNaN(stock) || stock < 0) return;
        editMealObj.stock = stock;
      });

      if(!$('#mealNotes').is(':focus')) $('#mealNotes').val(item.notes);
      $('#mealNotes').unbind('input').on('input', function() {
        editMealObj.notes = $(this).val();
      });
     
      $('.mealTypeCheck').prop('checked', false);
      item.types = item.types || {};
      for (var type in item.types) $('.mealTypeCheck[data-type="'+type+'"]').prop('checked', true);
      $('.mealTypeCheck').unbind('change').on('change', function() {
        var type = getProp(this, 'type');
        editMealObj.types[type] = $(this).is(':checked');
      });

      var totalCost = 0;

      $('#mealContents').empty();
      for (var fId in item.food) {
        var foodItem = food[fId];

        if (foodItem.cost != null) totalCost += item.food[fId] * foodItem.cost * (foodItem.packAmount != null ? 1/foodItem.packAmount : 1);

        var haveAmount = _.sum(foodItem.items.map(a.prop('amount')));
        var expireStatement = '';
        expireStatement += '(Have ' + haveAmount;
        if (foodItem.items.length > 0) {
          var firstItemExpireDays = getSubItemDaysToExpire(foodItem.items[0], foodItem.id);
          if (firstItemExpireDays < 1e6) {
            if (firstItemExpireDays >= 0) {
              expireStatement += ', ' + foodItem.items[0].amount + ' bad in ' + firstItemExpireDays + ' days';
            } else {
              expireStatement += ', ' + foodItem.items[0].amount + ' went bad ' + (-firstItemExpireDays) + ' days ago';
            }
          }
        }
        expireStatement += ')';

        $('#mealContents').append($(''+
          '<div data-id="'+fId+'" style="background-color: lightgrey; padding: 5px; margin-top: 10px; border-radius: 5px;">'+
          '  <span class="icon-remove removeMealContents" style="float: right; font-size: 20px; margin-top: 5px; margin-right: 10px; margin-left: 5px;"></span>'+
          '  <input class="form-control amountMealContents" style="display: inline-block; width: 90px; height: 35px; margin-right: 0px;" value="'+item.food[fId]+'">'+
          '  <h6 class="foodEdit" style="display: inline-block;margin-top: 7px;vertical-align: top; margin-left: 5px;">'+foodItem.name+'</h6>'+          
          (expireStatement.length > 0 ? '<h6 class="foodEdit" style="margin-left: 5px; margin-top: 7px; vertical-align: top; color: grey; display: inline-block;">'+expireStatement+'</h6>' : '')+
          '<h6 class="icon-arrow-right foodEdit" style="margin-left: 10px;margin-right: 5px; margin-top: 9px; vertical-align: top; display: inline-block;"></span>'+
          '</div>'));
      }

      $('.foodEdit').unbind('click').click(function() {
        foodId = getProp(this, 'id');
        editFoodObj = clone(food[foodId]);
        refreshFoodModal();
        openModal('#foodModal');
      });

      $('.amountMealContents').parent().removeClass('has-error');
      $('.amountMealContents').unbind('input').on('input', function() {
        var fId = getProp(this, 'id');
        var amount = parseFloat($(this).val())
        var isErr = isNaN(amount);
        $(this).parent().toggleClass('has-error', isErr);
        if (isErr) return;
        editMealObj.food[fId] = amount;

        var totalCost = 0;
        for (var fId in item.food) {
          var foodItem = food[fId];
          if (foodItem.cost != null) totalCost += item.food[fId] * foodItem.cost * (foodItem.packAmount != null ? 1/foodItem.packAmount : 1);
        }

        $('#mealCost').text('Total Cost: $' + roundToDecimals(totalCost, 2));
      });

      $('.removeMealContents').unbind('click').click(function() {
        var fId = getProp(this, 'id');
        delete editMealObj.food[fId];
        updateFood(fId);
        refreshMealModal();
      });

      $('#mealCost').text('Total Cost: $' + roundToDecimals(totalCost, 2));
    };

    var refreshEditModal = function() {
      $('#editList').empty();
      for (var id in editObj) {
        var item = food[id] || meals[id];

        $('#editList').append($(''+
          '<div data-id="'+id+'" style="background-color: lightgrey; padding: 5px; margin-top: 10px; border-radius: 5px;">'+
          '  <input class="form-control editListAmount" style="display: inline-block; width: 80px; height: 35px; margin-right: 5px;" value="'+editObj[id]+'">'+
          '  <h6 style="display: inline-block;">'+item.name+'</h6>'+
          '  <span class="icon-remove editListRemove" style="float: right; font-size: 20px; margin-top: 5px; margin-right: 10px; margin-left: 5px;"></span>'+
          '</div>'));
      }

      $('.editMode[data-type="add"]')
        .toggleClass('btn-primary', editMode == 'add')
        .removeClass('btn-light', editMode != 'add');
      $('.editMode[data-type="remove"]')
        .toggleClass('btn-danger', editMode == 'remove')
        .removeClass('btn-light', editMode != 'remove');

      $('.editMode').unbind('click').click(function() {
        editMode = getProp(this, 'type');
        refreshEditModal();
      });

      $('#editSubmit').unbind('click').click(function() {
        if (editMode == 'add') {
          for (var fId in editObj) {
            var foodItem = food[fId];

            var lastItem = (foodItem.items || []).slice(-1)[0];
            if (foodItem.items.length == 0 || lastItem.bought != date.getTime()) {
              foodItem.items.push({
                bought: date.getTime(),
                amount: editObj[fId]
              });
            } else {
              lastItem.amount += editObj[fId];
            }
            updateFood(fId);
          }
        } else if (editMode == 'remove') {
          // Bringing down the amount of a closed pack should open it if opened as a pack, or if not as a pack and a fraction is left, go for it.
          for (var fId in editObj) {
            var foodItem = food[fId];
            if (foodItem.items.length == 0) continue;

            var openInPack = foodItem.expireDaysAfterOpen != null && foodItem.packAmount != null && !!foodItem.openInPack;
            var stepAmt = openInPack ? foodItem.packAmount : 1;

            var amountLeft = editObj[fId];
            foodItem.items.map(function(item) {
              if (amountLeft > 0) {
                if (amountLeft < item.amount) {
                  item.amount -= amountLeft;
                  amountLeft = 0;
                  if (foodItem.expireDaysAfterOpen != null && item.opened == null && amountLeft < stepAmt) {
                    // If closed, and amount left is less than amt in pack or self, then bump out into its own opened thing. Leave a multiple of stepAmt
                    var bumpAmt = item.amount % stepAmt;
                    if (bumpAmt == 0) {
                      item.opened = date.getTime();
                    } else {
                      item.amount -= bumpAmt;
                      foodItem.items.unshift({
                        bought: item.bought,
                        amount: bumpAmt,
                        opened: date.getTime()
                      });                      
                    }
                  }
                } else {
                  amountLeft -= item.amount;
                  item.amount = 0;
                }
              }
            });

            foodItem.items = foodItem.items.filter((n) => n.amount > 0);

            updateFood(fId);
          }
        }

        editObj = {};
        refresh();
        $('#editModal').modal('hide');
      });

      $('.editListRemove').unbind('click').click(function() {
        var id = getProp(this, 'id');
        delete editObj[id];
        refreshEditModal();
      });

      $('.editListAmount').unbind('input').on('input', function() {
        var id = getProp(this, 'id');
        var amount = parseFloat($(this).val());
        if (isNaN(amount) || amount < 0) return;
        editObj[id] = amount;
        if (amount == 0) delete editObj[id];
      });
    };

    getSubItemDaysToExpire = function(subItem, fId) {
      var expireDays = [];

      var item = food[fId];
      if (item.expireDaysAfterOpen != null && subItem.opened != null) {
        var openedDate = new Date(subItem.opened);
        var daysSinceOpened = (Date.now() - openedDate.getTime()) / day;
        expireDays.push(Math.floor(item.expireDaysAfterOpen - daysSinceOpened));
      }

      if (item.expireDays != null) {
        var boughtDate = new Date(subItem.bought);
        var daysSinceBought = (Date.now() - boughtDate.getTime()) / day;
        expireDays.push(Math.floor(item.expireDays - daysSinceBought));
      }

      if (expireDays.length == 0) return 1e6;
      return _.min(expireDays);
    };

    getDaysToExpire = function(fId) {
      var item = food[fId];
      if (item.items.length == 0) return 1e6; // Won't expire for a long time

      return _.min(item.items.map(function(subItem) {
        return getSubItemDaysToExpire(subItem, fId);
      }));
    };

    var dateInput = function(fId, subIndex, type, isRight) {
      var item = food[fId];
      var subItem = item.items[subIndex];
      var subItemDate = new Date(subItem[type]);
      var dateText = (subItemDate.getMonth()+1)+'/'+(subItemDate.getDate());

      if (isRight) {
        return '<span data-fId="'+fId+'" data-subIndex="'+subIndex+'" data-type="'+type+'"><span class="dateInput">'+dateText+'</span><input type="text"'+
          'data-date-format="mm/dd" data-language="en" '+
          'class="datepicker-here" '+
          'data-position="bottom right" '+
          'style="width: 0px; visibility: hidden; display: inline-block;" autocomplete="off" aria-autocomplete="list"></span>';
      } else {
        return '<span data-fId="'+fId+'" data-subIndex="'+subIndex+'" data-type="'+type+'"><input type="text"'+
          'data-date-format="mm/dd" data-language="en" '+
          'class="datepicker-here" '+
          'data-position="bottom left" '+
          'style="width: 0px; visibility: hidden; display: inline-block;" autocomplete="off" aria-autocomplete="list"><span class="dateInput">'+dateText+'</span></span>';
      }
    };

    var addGoalSectionBox = null;
    var addGrocerySectionBox = null; 
    var mealContentAddSectionBox = null;
    var foodStoreBox = null;
    var editLookUpBox = null;

    var refresh = function() {
      $('.tabText').removeClass('custom-underline');
      $('.tab[data-tab="'+tab+'"]').find('.tabText').addClass('custom-underline');

      foodQuery = $('#foodFilter').val();
      mealQuery = $('#mealFilter').val();

      var mealData = keys(meals).map(function(mId) {
        return { label: meals[mId].name, value: mId };
      });
      var foodData = keys(food).map(function(fId) {
        return { label: food[fId].name, value: fId }
      });

      if (addGoalSectionBox != null) addGoalSectionBox.list = mealData;
      if (addGrocerySectionBox != null) addGrocerySectionBox.list = foodData;
      if (mealContentAddSectionBox != null) mealContentAddSectionBox.list = foodData;
      if (foodStoreBox != null) foodStoreBox.list = _.uniq(_.values(food).map(a.prop('store')));
      if (editLookUpBox != null) {
        editLookUpBox.list = keys(food).map(function(fId) {
          return { label: food[fId].name + ' (Food)', value: fId }
        }).concat(keys(meals).filter(function(mId) {
          return keys(meals[mId].food).length > 1;
        }).map(function(mId) {
          return { label: meals[mId].name + ' (Meal)', value: mId }
        }));
      }

      $('#foodSection, #foodFilter').css('display', tab == 'food' ? 'inline-block' : 'none');
      $('#mealSection, #mealFilter').css('display', tab == 'meals' ? 'inline-block' : 'none');
      $('#grocerySection').toggle(tab == 'grocery');
      $('#newItem').css('display', tab != 'grocery' ? 'inline-block' : 'none');
      $('#mealType').css('display', tab == 'meals' ? 'inline-block' : 'none');

      $('#groceryList, #addGrocerySection').toggle(groceryMode == 'buy')
      $('#goalList, #addGoalSection').toggle(groceryMode == 'goals');

      if (tab == 'food') {

        $('#foodList').empty();
        var foodList = _.values(food).filter(function(item) {
          if (foodQuery.trim().length == 0) return true;
          return item.name.toLowerCase().indexOf(foodQuery.toLowerCase()) >= 0;
        });
        foodList = _.sortBy(foodList, function(item) {
          if (item.items.length == 0) return 1e7; // Put at bottom of list
          return getDaysToExpire(item.id);
        }).map(function(item) {
          $('#foodList').append($(''+
            '<div data-id="'+item.id+'" class="foodRow">'+
            '  <div class="foodEdit">'+
            '    <h6 style="display: inline-block; width: calc(100% - 60px);'+(item.items.length == 0 ? 'color: grey;' : '')+'">'+item.name+'</h6>'+
            // '    <span class="icon-pencil" style="margin-right: 5px; float: right;"></span>'+
            '    <span class="icon-plus addFood" style="margin-right: 5px; float: right; font-size: 18px;"></span>'+
            '  </div>'+
            '  <div>'+
            item.items.map(function(subItem, sub_i) {
              var daysToExpire = getSubItemDaysToExpire(subItem, item.id);
    
              var boughtDate = new Date(subItem.bought);
              var openedDate = subItem.opened != null ? new Date(subItem.opened) : null;

              var expireNote = null;
              if (item.expireDays != null || (item.expireDaysAfterOpen != null && subItem.opened != null)) {
                if (daysToExpire > 0) {
                  // Math.round(item.expireDays - daysSinceBought)
                  expireNote = '<h6 style="display: inline-block; color: grey; margin-right: 2px; margin-left: 5px;">(bad in '+daysToExpire+' days)</h6>'
                } else {
                  var expireDate = new Date(Date.now() + daysToExpire * day);
                  expireNote = '<h6 style="display: inline-block; color: #e60606; margin-right: 2px; margin-left: 5px;">(went bad on ' + (expireDate.getMonth()+1)+'/'+(expireDate.getDate()) + ')</h6>'
                }
              }

              return ''+
              '<div class="itemRow" data-subIndex="'+sub_i+'">'+
              '  <input class="form-control amtInput subItemAmt" style="vertical-align: top;" value="'+subItem.amount+'" type="number">'+
              '<span style="display: inline-block; margin-bottom: 10px; width: calc(100% - 60px); margin-top: 4px;"><h6 style="display: inline-block;margin-left: 5px;margin-right: 0px;">from'+dateInput(item.id, sub_i, 'bought', false)+'</h6>'+
              (subItem.opened != null ? 
              '<h6 style="display: inline-block;margin-left: 5px;"> opened '+dateInput(item.id, sub_i, 'opened', true)+'</h6>' : '')+
              (expireNote != null ? expireNote : '')+
              ((subItem.opened == null && item.expireDaysAfterOpen != null) ? '  <h6 class="btn btn-sm btn-primary subItemOpen" style="display: inline-block;margin-top: 5px;padding-bottom: 2px;padding-top: 2px; margin-right: 5px;">Open '+((item.packAmount != null && !!item.openInPack) ? ('Pack of ' + item.packAmount) : '1')+'</h6>' : '')+
              '<span class="icon-remove itemRemove" style="margin-left: 5px;"></span></span>'+
              '</div>';
            }).join('')+
            '  </div>'+
            '</div>'));
        });

        $('.addFood').unbind('click').click(function(e) {
          e.stopPropagation();
          var fId = getProp(this, 'id');
          var foodItem = food[fId];
          editObj = {};
          editMode = 'add';

          var openInPack = foodItem.expireDaysAfterOpen != null && foodItem.packAmount != null && !!foodItem.openInPack;
          var stepAmt = openInPack ? foodItem.packAmount : 1;
          editObj[fId] = stepAmt;

          refreshEditModal();
          openModal('#editModal');
        });

        $('.subItemAmt').unbind('input').on('input', function() {
          var fId = getProp(this, 'id');
          var subIndex = parseInt(getProp(this, 'subIndex'));
          var amount = parseFloat($(this).val())
          if (isNaN(amount) || amount < 0) return;
          food[fId].items[subIndex].amount = amount;
          updateFood(fId);
        });

        $('.subItemOpen').unbind('click').on('click', function() {
          var fId = getProp(this, 'id');
          var subIndex = parseInt(getProp(this, 'subIndex'));
          var foodItem = food[fId];
          var subItem = foodItem.items[subIndex];

          // Check if open in packs
          var openInPack = foodItem.expireDaysAfterOpen != null && foodItem.packAmount != null && !!foodItem.openInPack;
          var stepAmt = openInPack ? foodItem.packAmount : 1;

          var existingOpenItem = null;
          foodItem.items.map(function(subItem2) {
            if (existingOpenItem == null && subItem2.opened == date.getTime() && subItem2.bought == subItem.bought) {
              existingOpenItem = subItem2;
            }
          });

          if (existingOpenItem != null) {
            existingOpenItem.amount += stepAmt;
            subItem.amount -= stepAmt;
            if (subItem.amount == 0) foodItem.items.splice(subIndex, 1);
          } else {
            if (subItem.amount <= stepAmt) {
              subItem.opened = date.getTime();
            } else {
              subItem.amount -= stepAmt;
              foodItem.items.unshift({
                bought: subItem.bought,
                amount: stepAmt,
                opened: date.getTime()
              });
            }
          }

          updateFood(fId);
          refresh();
        });

        $('.itemRemove').unbind('click').click(function() {
          var fId = getProp(this, 'id');
          var subIndex = parseInt(getProp(this, 'subIndex'));
          food[fId].items.splice(subIndex, 1);
          updateFood(fId);
          refresh();
        });

        $('.datepicker-here').datepicker({
          language: 'en',
          autoClose: true,
          maxDate: new Date(),
          onSelect: function(dateText, dateObj, e) {
            var dateTime = dateObj.getTime();
            var fId = getProp(arguments[2].el, 'id');
            var subIndex = parseInt(getProp(arguments[2].el, 'subIndex'));
            var type = getProp(arguments[2].el, 'type');
            food[fId].items[subIndex][type] = dateTime;
            var subItem = food[fId].items[subIndex];

            if (subItem.opened != null && subItem.opened < subItem.bought) delete subItem.opened;

            food[fId].items = _.sortBy(food[fId].items, function(subItem) {
              return getSubItemDaysToExpire(subItem, fId);
            });
            updateFood(fId);
            refresh();
          }
        });

        $('.dateInput').unbind('click').click(function() {
          var datepicker = $(this).parent().find('.datepicker-here').datepicker().data('datepicker');
          datepicker.show();
        });
      }

      var mealList = _.values(meals);

      if (tab == 'meals') {

        $('#mealType').val(mealType);
        $('#mealType').unbind('change').on('change', function() {
          mealType = $(this).val();
          refresh();
        })

        var getMaxMeals = function(mealItem) {
          if (keys(mealItem.food).length == 0) {
            var maxMeals = 0;
          } else {
            var maxMeals = Math.floor(_.min(keys(mealItem.food).map(function(fId) {
              // If an item has gone bad, don't include it in amount
              var daysToExpire = getDaysToExpire(fId);            
              if (daysToExpire < 0) return 0;

              return _.sum(food[fId].items.map(a.prop('amount'))) / mealItem.food[fId];
            })));
          }
          return maxMeals;
        }

        $('#mealList').empty();
        _.orderBy(mealList.filter(function(item) {
          // Query filter
          if (mealQuery.trim().length == 0) return true;
          return item.name.toLowerCase().indexOf(mealQuery.toLowerCase()) >= 0;
        }).filter(function(item) {
          // Type filter
          if (mealType == 'all') return true;
          return (item.types || {})[mealType] != null;
        }), [function(item) {
          return getMaxMeals(item) > 0 ? -1 : 0;
        }, function(mealItem) {
          // How long until goes bad.
          if (keys(mealItem.food).length == 0) {
            return -1e8;
          } else {
            return _.min(keys(mealItem.food).map(function(fId) {
              return getDaysToExpire(fId);
            }));
          }
        }, function(mealItem) {
          return -getMaxMeals(mealItem);
        }]).map(function(item) {
          // Number of meals available

          // Find the limiting factor for each ingredient
          var maxMeals = getMaxMeals(item);
          var minTimeToExpire = _.min(keys(item.food).map(function(fId) {
            return getDaysToExpire(fId);
          }));
          var expireText = '';
          if (minTimeToExpire != null && minTimeToExpire < 1e6 && maxMeals > 0) {
            expireText = '<span style="color: grey;">(bad in ' + minTimeToExpire + ' days)</span>';
          } 

          $('#mealList').append($(''+
            '<div data-id="'+item.id+'" class="mealRow">'+
            '  <div class="mealEdit" style="'+(maxMeals == 0 ? 'color:grey;' : '')+'">'+
            '    <h6 style="display: inline-block; margin-bottom: 0px; width: calc(100% - 30px);">'+item.name+' for '+item.serves+' (x'+maxMeals+') '+expireText+'</h6>'+
            '    <span class="icon-pencil" style="margin-right: 5px; float: right;"></span>'+
            '  </div>'+
            '</div>'));
        });
      }

      if (tab == 'grocery') {

        $('#groceryList, #goalList').empty();
          
        var groceryList = {}; // key == store, value = {'fId'}

        mealList.map(function(item) {
          if (item.stock == null || item.stock == 0) return;

          $('#goalList').append($(''+
            '<div data-id="'+item.id+'" class="goalRow">'+
            '  <input class="form-control amtInput goalInput" style="vertical-align: top; margin-right: 5px;" value="'+item.stock+'" type="number">'+
            '  <span style="width: calc(100% - 80px); display: inline-block; margin-bottom: 10px; margin-top: 4px; line-height: 25px;">'+
              '  <h6 class="mealEdit" style="display: inline;margin-bottom: 0px;margin-top: 4px;">'+item.name+' for '+item.serves+'</h6>'+
              '  <span class="icon-pencil mealEdit" style="margin-left: 7px; display: inline;"></span>'+
              '  <span class="icon-remove goalRemove" style="margin-left: 7px; display: inline;"></span>'+
            '  </span>'+
            '</div>'));

          for (var fId in item.food) {
            var fItem = food[fId];
            if (fItem.store == null) continue;
            groceryList[fItem.store] = groceryList[fItem.store] || {};
            if (groceryList[fItem.store][fItem.id] == null) groceryList[fItem.store][fItem.id] = 0;
            groceryList[fItem.store][fItem.id] += item.stock * item.food[fId];    
          }
        });

        // Remove stuff that we have
        for (var store in groceryList) {
          for (var fId in groceryList[store]) {
            var foodItem = food[fId];
            var haveAmount =  _.sum(foodItem.items.map(a.prop('amount')));
            if (groceryList[store][fId] <= haveAmount) delete groceryList[store][fId];
            else groceryList[store][fId] -= haveAmount;
          }
          if (empty(groceryList[store])) delete groceryList[store];
        }

        $('.goalInput').unbind('input').on('input', function() {
          var mId = getProp(this, 'id');
          var mItem = meals[mId];
          var amount = parseInt($(this).val());
          if (mItem == null || isNaN(amount) || amount < 0) return;
          mItem.stock = amount;
          if (amount == 0) delete mItem.stock;
          updateMeal(mId);
        });

        $('.goalRemove').unbind('click').on('click', function() {
          var mId = getProp(this, 'id');
          var mItem = meals[mId];
          delete mItem.stock;
          updateMeal(mId);
          refresh();
        });

        for (var store in groceryCart) groceryList[store] = groceryList[store] || {};

        var totalNum = 0;

        keys(groceryList).map(function(store, i) {
          $('#groceryList').append($('<h5 style="margin-top: '+(i == 0 ? 10 : 40)+'px; text-decoration: underline;">'+store+' List</h5>'));
          var totalCost = 0;

          for (var fId in groceryList[store]) {
            // Recognize that things which are sold in packs should be described as a pack

            var text = '';
            text += 'Got <input class="form-control groceryInput" style="width: 60px; display: inline-block; height: 32px; margin-left: 2px;" placeholder="#" ';
            if (groceryCart[store] != null && groceryCart[store][fId] != null && groceryCart[store][fId] != 0) {
              totalNum += groceryCart[store][fId];
              text += 'value="'+groceryCart[store][fId]+'"';
            }
            text += '> - ';            

            var amountNeeded = groceryList[store][fId];
            if (food[fId].packAmount != null) {
              var num = Math.ceil(amountNeeded/food[fId].packAmount);
              text += 'Need ' + num + ' Pack'+(num != 1 ? 's' : '')+' of ' + food[fId].name;
            } else {
              var num = Math.ceil(amountNeeded);
              text += 'Need ' + num + ' ' + food[fId].name;
            }

            if (food[fId].cost != null) {
              if (groceryCart[store] != null && groceryCart[store][fId] != null) {
                totalCost += food[fId].cost * groceryCart[store][fId];
              }
              text += '<span style="color: grey;"> ($' + roundToDecimals(food[fId].cost * num, 2) + ')</span>';
            }

            text += '<span class="icon-pencil foodEdit" style="margin-left: 10px;"></span>';

            $('#groceryList').append($('<h6 data-id="'+fId+'" data-store="'+store+'" style="line-height: 35px;">'+text+'</h6>')); 
          }

          for (var fId in groceryCart[store]) {
            if (groceryList[store][fId] == null) {
              $('#groceryList').append($(''+
                '<h6 data-store="'+store+'" data-id="'+fId+'">Got <input class="form-control groceryInput" style="width: 60px;display: inline-block;height: 32px;" placeholder="#" value="'+(groceryCart[store][fId] > 0 ? groceryCart[store][fId] : '')+'"> + '+
                (food[fId].packAmount != null ? 'Packs of ' : '')+food[fId].name+
                (food[fId].cost != null ? '<span style="color: grey;"> ($' + food[fId].cost + ')</span>' : '')+
                '<span class="icon-remove groceryRemove" style="margin-left: 10px;"></span>'+
                '<span class="icon-pencil foodEdit" style="margin-left: 15px;"></span>'+
                '</h6>'));        

              totalNum += groceryCart[store][fId];
              if (food[fId].cost != null) totalCost += food[fId].cost * groceryCart[store][fId];
            }
          }

          $('#groceryList').append($('<h6 class="totalCost" data-store="'+encodeURIComponent(store)+'" style="margin-top: 10px; color: green; display: '+(totalCost != 0 ? 'inline-block' : 'none')+';">Total Cost: $'+roundToDecimals(totalCost, 2)+'</h6>'));
        });

        $('.groceryInput').unbind('input').on('input', function() {
          var id = getProp(this, 'id');
          var store = getProp(this, 'store');
          var amount = parseInt($(this).val());
          if ($(this).val().trim().length == 0) amount = 0;
          if (isNaN(amount) || amount < 0) return;

          groceryCart[store] = groceryCart[store] || {};
          groceryCart[store][id] = amount;

          var totalCost = 0;
          for (var fId in groceryList[store]) {
            if (groceryCart[store] != null && groceryCart[store][fId] != null && food[fId].cost != null) {
              totalCost += food[fId].cost * groceryCart[store][fId];
            }
          }
          for (var fId in groceryCart[store]) {
            if (groceryList[store][fId] == null) {
              if (food[fId].cost != null) totalCost += food[fId].cost * groceryCart[store][fId];
            }
          }

          var totalNum = 0;
          keys(groceryList).map(function(store) {
            for (var fId in groceryList[store]) {
              if (groceryCart[store] != null && groceryCart[store][fId] != null) {
                totalNum += groceryCart[store][fId];
              }
            }

            for (var fId in groceryCart[store]) {
              if (groceryList[store][fId] == null) {
                totalNum += groceryCart[store][fId];
              }
            }
          });

          updateCart();
          
          $('#addAllFoodList').text('Add All '+totalNum+' to Food List').toggle(totalNum > 0);
          $('.totalCost[data-store="'+encodeURIComponent(store)+'"]').text('Total Cost: $'+roundToDecimals(totalCost, 2)).toggle(totalCost > 0);
        });

        $('.groceryRemove').unbind('click').on('click', function() {
          var fId = getProp(this, 'id');
          var store = getProp(this, 'store');
          delete groceryCart[store][fId];
          if (empty(groceryCart[store])) delete groceryCart[store];
          updateCart();
          refresh();
        });

        $('#groceryList').append($('<br>'));
        $('#groceryList').append($('<h6 id="addAllFoodList" class="btn btn-primary btn-sm" style="margin-top: 10px; display: '+(totalNum > 0 ? 'inline-block' : 'none')+';">Add All '+totalNum+' to Food List</h6>'));

        $('#addAllFoodList').unbind('click').click(function() {
          console.log(groceryCart);
          editObj = {};
          for (var store in groceryCart) {
            for (var fId in groceryCart[store]) {
              if (editObj[fId] == null) editObj[fId] = 0;
              editObj[fId] += groceryCart[store][fId];
            }
          }
          editMode = 'add';
          refreshEditModal();
          openModal('#editModal');
        });

        $('.groceryMode').removeClass('btn-dark').addClass('btn-light');
        $('.groceryMode[data-type="'+groceryMode+'"]').toggleClass('btn-dark').removeClass('btn-light');
      }

      $('.foodEdit').unbind('click').click(function(e) {
        console.log($(document.activeElement), e);
        foodId = getProp(this, 'id');
        editFoodObj = clone(food[foodId]);
        refreshFoodModal();
        openModal('#foodModal');
      });

      $('.mealEdit').unbind('click').click(function() {
        mealId = getProp(this, 'id');
        editMealObj = clone(meals[mealId]);
        refreshMealModal();
        openModal('#mealModal');
      });

      $('input, textarea').unbind('focus, blur').on('focus', function() {
        editingInput = true;
        clearTimeout(blurTimeout);
      }).on('blur', function() {
        blurTimeout = setTimeout(function() {
          editingInput = false;
        }, 200);
      });
    }

    jsonpg.setKey('gavinovsak', 'QaMtKn7p9yDuctl');

    var mealFilterCallback = null;
    var foodFilterCallback = null;

    var editingInput = false;
    var blurTimeout = null;

    $(function() {
      refresh();

      jsonpg.watch({ path: 'gavinovsak.food', frequency: 2000}, function(data) {
        console.log('got data', data);
        if (data == null) return;

        var foodDiff = isDiff(food, data.food);
        var mealDiff = isDiff(meals, data.meals);
        var groceryCartDiff = isDiff(groceryCart, data.groceryCart);
        food = data.food || {};
        meals = data.meals || {};
        groceryCart = data.groceryCart || {};
        if (foodDiff || mealDiff || groceryCartDiff) refresh();

        // jsonpg.set('gavinovsak.food.food.f5', null, function(data) {
        //   console.log('callback', data)
        // })
      });

      $('#mealFilter').unbind('input').on('input', function() {
        mealQuery = $(this).val();
        clearTimeout(mealFilterCallback);
        mealFilterCallback = setTimeout(refresh, 100);
      });

      $('#foodFilter').unbind('input').on('input', function() {
        foodQuery = $(this).val();
        clearTimeout(foodFilterCallback);
        foodFilterCallback = setTimeout(refresh, 100);
      });

      $('.groceryMode').unbind('click').click(function() {
        groceryMode = getProp(this, 'type');
        refresh();
      })

      $('.tab').unbind('click').click(function() {
        tab = getProp(this, 'tab');
        refresh();
      });

      $('#addRemoveToggle').unbind('click').click(function() {
        editObj = {};
        refreshEditModal();
        openModal('#editModal');
      });

      $('.datepicker-here').datepicker({
        language: 'en',
        autoClose: true,
        maxDate: new Date()
      });

      $('#newItem').unbind('click').click(function() {
        if (tab == 'food') {
          editFoodObj = {
            name: '',
            items: []
          }
          foodId = null;
          refreshFoodModal();
          openModal('#foodModal');
        } else if (tab == 'meals') {
          editMealObj = {
            name: '',
            serves: 2,
            types: {},
            food: {}
          }
          mealId = null;
          refreshMealModal();
          openModal('#mealModal');
        }
      });

      $('#foodSave').unbind('click').click(function() {
        $('#foodModal').modal('hide');
        if (editFoodObj.id == null) editFoodObj.id = getNewId(food, 'f');
        food[editFoodObj.id] = editFoodObj;
        updateFood(editFoodObj.id);
        refresh();
      });

      $('#foodDelete').unbind('click').click(function() {
        $('#foodModal').modal('hide');
        if (editFoodObj.id == null) return;
        delete food[editFoodObj.id];
        updateFood(editFoodObj.id);
        refresh();
      });

      $('#mealSave').unbind('click').click(function() {
        $('#mealModal').modal('hide');
        if (editMealObj.id == null) editMealObj.id = getNewId(meals, 'm');
        meals[editMealObj.id] = editMealObj;
        updateMeal(editMealObj.id);
        refresh();
      });

      $('#mealDelete').unbind('click').click(function() {
        $('#mealModal').modal('hide');
        if (editMealObj.id == null) return;
        delete meals[editMealObj.id];
        updateMeal(editMealObj.id);
        refresh();
      });

      addGoalSectionBox = new Awesomplete($('#addGoalSection')[0], {
        list: [],
        replace: function() {
          $('#addGoalSection').val('');
        },
        minChars: 1,
        autoFirst: true,
        maxItems: 8
      });
      $('#addGoalSection').parent().css('width', '100%');
      $('#addGoalSection').on('awesomplete-selectcomplete', function(e) {
        var mId = e.originalEvent.text.value;
        if (meals[mId].stock == null) meals[mId].stock = 0;
        meals[mId].stock++;
        updateMeal(mId);
        refresh();
      });

      addGrocerySectionBox = new Awesomplete($('#addGrocerySection')[0], {
        list: [],
        replace: function() {
          $('#addGrocerySection').val('')
        },
        minChars: 1,
        autoFirst: true,
        maxItems: 8
      });
      $('#addGrocerySection').parent().css('width', '100%');
      $('#addGrocerySection').on('awesomplete-selectcomplete', function(e) {
        var fId = e.originalEvent.text.value;
        var foodItem = food[fId];
        if (foodItem.store == null) return;
        groceryCart[foodItem.store] = groceryCart[foodItem.store] || {};
        if (groceryCart[foodItem.store][fId] == null) groceryCart[foodItem.store][fId] = 0;
        updateCart();
        refresh();
      });

      mealContentAddSectionBox = new Awesomplete($('#mealContentAddSection')[0], {
        list: [],
        replace: function() {
          $('#mealContentAddSection').val('')
        },
        minChars: 1,
        autoFirst: true,
        maxItems: 8
      });
      $('#mealContentAddSection').parent().css('width', '100%').css('font-size', '17px');
      $('#mealContentAddSection').on('awesomplete-selectcomplete', function(e) {
        editMealObj.food[e.originalEvent.text.value] = 1;
        refreshMealModal();
      });

      editLookUpBox = new Awesomplete($('#editLookUp')[0], {
        list: [],
        replace: function() {
          $('#editLookUp').val('')
        },
        minChars: 1,
        autoFirst: true,
        maxItems: 8
      });
      $('#editLookUp').parent().css('width', '100%').css('font-size', '17px');
      $('#editLookUp').on('awesomplete-selectcomplete', function(e) {
        var id = e.originalEvent.text.value;
        if (food[id] != null) {
          if (editObj[id] == null) editObj[id] = 0;
          editObj[id] += 1;
        } else if (meals[id] != null) {
          for (var fId in meals[id].food) {
            if (editObj[fId] == null) editObj[fId] = 0;
            editObj[fId] += meals[id].food[fId];
          }
        }
        refreshEditModal();
      });

      foodStoreBox = new Awesomplete($('#foodStore')[0], {
        list: [], 
        minChars: 1,
        autoFirst: true,
        maxItems: 8
      });
      $('#foodStore').parent().css('width', '200px').css('display', 'inline-block').css('font-size', '17px');
      $('#foodStore').on('awesomplete-selectcomplete', function(e) {
        editFoodObj.store = $('#foodStore').val();
      });

      var oldWidth = $(window).width();
      $(window).on('resize', function() {
        if ($(window).width() != oldWidth) {
          // refreshSection();
          oldWidth = $(window).width();
        }
        ['#foodModal', '#mealModal', '#editModal'].map(setMaxHeight);
      });
    })

  </script>
  <div class="container" style="position: relative;height: 100%; width: 100%; max-width: 650px;">
    <div style="background-color: white; width: 100%;">
      <h5 id="addRemoveToggle" class="btn btn-primary btn-sm" style="display: inline-block; vertical-align: top;margin-top: 10px; margin-right: 10px;">Add or Eat</h5>
      <div style="display: inline-block;max-width: 100%;">
        <div id="mainTabSection" style="align-items: flex-start; padding-bottom: 2px; margin-left: 10px; display: inline-block;">
          <h5 class="tab" data-tab="food" style="margin-right: 25px;"><span class="tabText custom-underline-blue">Food</span></h5>
          <h5 class="tab" data-tab="meals" style="margin-right: 25px;"><span class="tabText custom-underline-green custom-underline">Meals</span></h5>
          <h5 class="tab" data-tab="grocery"><span class="tabText custom-underline-orange">Grocery List</span></h5>
        </div>
      </div>
    </div>
    <div style="padding-top: 10px; position: relative;">
      <select id="mealType" class="form-control" style="width: auto;height: 37px; vertical-align: top;display: none;padding-right: 0px;padding-left: 5px;">
        <option value="all">All Meals</option>
        <option value="breakfast">Breakfast</option>
        <option value="lunch">Lunch</option>
        <option value="snacks">Snacks</option>
        <option value="dinner">Dinner</option>
      </select>
      <input id="foodFilter" class="form-control" style="width: calc(100% - 75px); height: 37px; display: none;" placeholder="Filter">
      <input id="mealFilter" class="form-control" style="width: calc(100% - 175px); height: 37px; display: none;" placeholder="Filter">
      <div id="newItem" class="btn btn-primary" style="height: 37px; vertical-align: top; padding-top: 4px; display: none;">New</div>
    </div>
    <div id="foodSection" style="padding-top: 10px; position: relative;height: calc(100% - 100px);display: none; width: 100%;">
      <div id="foodList" style="overflow-y: scroll; height: 100%; width: 100%;"></div>
    </div>
    <div id="mealSection" style="position: relative; height: calc(100% - 100px); display: none; margin-top: 10px; width: 100%;">
      <div id="mealList" style="padding-top: 0px; overflow-y: scroll; height: 100%; width: 100%;"></div>
    </div>
    <div id="grocerySection" style="position: relative;height: calc(100% - 60px); display: none">
      <div class="btn-group" role="group" style="margin-top: 0px;">
        <button type="button" data-type="buy" class="btn btn-dark btn-sm groceryMode">To Buy</button>
        <button type="button" data-type="goals" class="btn btn-light btn-sm groceryMode">Meal Goals</button>
      </div>
      <input id="addGrocerySection" style="margin-top: 15px;" type="text" class="form-control" placeholder="Add Food">
      <div id="groceryList" style="padding-top: 0px; overflow-y: scroll; height: calc(100% - 100px); width: 100%; margin-top: 15px;"></div>
      <input id="addGoalSection" style="margin-top: 15px;" type="text" class="form-control" placeholder="Add Meals">
      <div id="goalList" style="padding-top: 0px; overflow-y: scroll; height: calc(100% - 100px); width: 100%; margin-top: 15px;">
        <div>
        </div>
      </div>
    </div>
  </div>

  <div id="foodModal" class="modal fade in" role="dialog" style="overflow-x: scroll; overflow-y: hidden">
    <div class="modal-dialog" style="min-width: 300px; margin-top: 15px; overflow-y: initial !important;">
      <div class="modal-content">
        <div class="modal-header" style="">
          <h5 id="foodModalTitle" style="margin-top: 0px; margin-bottom: 0px; float: left;">Edit Food</h5>
          <span class="icon-remove" style="float: right; font-size: 22px;" data-dismiss="modal"></span>
        </div>
        <div class="modal-body" style="width: 100%; padding-top: 0px; margin-bottom: 20px; overflow-y: scroll; max-height: 570px; font-size: 15px; user-select: text;">
          <div style="margin-top: 20px;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Name:</h6>
            <input id="foodName" placeholder="Food Name" class="form-control" style="width: 100%; display: inline-block; height: 35px; width: calc(100% - 80px);">
          </div>
          <div style="margin-top: 20px;">
            <h6 style="display: inline-block; margin-right: 0px; vertical-align: top; margin-top: 7px;">Cost: $</h6>
            <input id="foodCost" placeholder="$" class="form-control" style="display: inline-block; height: 35px; width: 80px;">
          </div>
          <div style="margin-top: 20px;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Good For </h6>
            <input id="foodExpireDays" placeholder="n/a" type="number" class="form-control" style="display: inline-block; height: 35px; width: 80px; margin-right: 5px;">
            <h6 style="display: inline-block;">Days</h6>
          </div>
          <div style="margin-top: 20px;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Store:</h6>
            <input id="foodStore" class="form-control" style="display: inline-block; height: 35px; width: 200px; margin-right: 5px;">
          </div>
          <div style="margin-top: 20px;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Amount In A Pack:</h6>
            <input id="foodPackAmount" placeholder="n/a" type="number" class="form-control" style="display: inline-block; height: 35px; width: 80px;">
          </div>
          <h6 style="margin-top: 40px; font-style: italic;">If Opening Affects Expiration:</h6>
          <div style="margin-top: 20px;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Good For </h6>
            <input id="foodExpireDaysAfterOpened" placeholder="n/a" type="number" class="form-control" style="display: inline-block; height: 35px; width: 80px; margin-right: 5px;">
            <h6 style="display: inline-block;">Days After Opened</h6>
          </div>
          <div style="margin-top: 20px;" id="foodOpenedAsPackSection">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Opened As A Pack: </h6>
            <div class="btn-group" role="group" style="margin-top: 0px; margin-left: 10px;">
              <button type="button" data-type="Yes" class="btn btn-success btn-sm foodOpenedAsPack">Yes</button>
              <button type="button" data-type="No" class="btn btn-light btn-sm foodOpenedAsPack">No</button>
            </div>
          </div>
          <h6 id="foodInMealTitle" style="margin-top: 20px;">Included In:</h6>
          <div id="foodInMealList">
            <div data-id="f44" style="background-color: lightgrey; padding: 5px; margin-top: 10px; border-radius: 5px;"><h6 style="display: inline-block;margin: 5px;">Blue Corn Tortilla Chips</h6>  <span class="icon-arrow-right removeMealContents" style="float: right; font-size: 20px; margin: 5px;  "></span></div>
            <div data-id="f44" style="background-color: lightgrey; padding: 5px; margin-top: 10px; border-radius: 5px;"><h6 style="display: inline-block;margin: 5px;">Blue Corn Tortilla Chips</h6>  <span class="icon-arrow-right removeMealContents" style="float: right; font-size: 20px; margin: 5px;  "></span></div>
          </div>
        </div>
        <div class="modal-footer" style="">
          <div id="foodSave" class="btn btn-sm btn-success" style="float: right;">Save</div>
          <div id="foodDelete" class="btn btn-sm btn-danger" style="float: right;">Delete</div>
        </div>
      </div>
    </div>
  </div>

  <div id="mealModal" class="modal fade in" role="dialog" style="overflow-x: scroll; overflow-y: hidden">
    <div class="modal-dialog" style="min-width: 300px; margin-top: 15px; overflow-y: initial !important;">
      <div class="modal-content">
        <div class="modal-header" style="">
          <h5 id="mealModalTitle" style="margin-top: 0px; margin-bottom: 0px; float: left;">Edit Meal</h5>
          <span class="icon-remove" style="float: right; font-size: 22px;" data-dismiss="modal"></span>
        </div>
        <div class="modal-body" style="width: 100%; padding-top: 0px; overflow-y: scroll; max-height: 570px; font-size: 15px; user-select: text;">
          <div style="margin-top: 20px;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Name:</h6>
            <input id="mealName" placeholder="Meal Name" class="form-control" style="width: 100%; display: inline-block; height: 35px; width: calc(100% - 80px);">
          </div>
          <div style="margin-top: 20px; display: inline-block; margin-right: 10px;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Serves:</h6>
            <input id="mealServes" placeholder="" type="number" class="form-control" style="display: inline-block; height: 35px; width: 80px;">
          </div>
          <div style="margin-top: 20px; display: inline-block;">
            <h6 style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Stock:</h6>
            <input id="mealStock" placeholder="None" type="number" class="form-control" style="display: inline-block; height: 35px; width: 100px;">
          </div>
          <div style="margin-top: 15px;">
            <h6>Notes:</h6>
            <textarea id="mealNotes" type="number" class="form-control" style="width: 100%; display: inline-block; height: 15px; min-height: 60px;"></textarea>
          </div>
          <div style="margin-top: 10px;">
            <div style="display: inline-block;margin-right: 10px;">
              <input class="mealTypeCheck" data-type="breakfast" placeholder="None" style="display: inline-block;  margin-top: 10px;" type="checkbox" class="">
              <h6 style="display: inline-block; margin-left: 5px; vertical-align: top; margin-top: 5px;">Breakfast</h6>
            </div>
            <div style="display: inline-block;margin-right: 10px;">
              <input class="mealTypeCheck" data-type="lunch" placeholder="None" style="display: inline-block;  margin-top: 10px;" type="checkbox" class="">
              <h6 style="display: inline-block; margin-left: 5px; vertical-align: top; margin-top: 5px;">Lunch</h6>
            </div>
            <div style="display: inline-block;margin-right: 10px;">
              <input class="mealTypeCheck" data-type="dinner" placeholder="None" style="display: inline-block;  margin-top: 10px;" type="checkbox" class="">
              <h6 style="display: inline-block; margin-left: 5px; vertical-align: top; margin-top: 5px;">Dinner</h6>
            </div>
            <div style="display: inline-block;margin-right: 10px;">
              <input class="mealTypeCheck" data-type="snack" placeholder="None" style="display: inline-block;  margin-top: 10px;" type="checkbox" class="">
              <h6 style="display: inline-block; margin-left: 5px; vertical-align: top; margin-top: 5px;">Snack</h6>
            </div>
          </div>
          <h6 style="margin-top: 15px;">Contents:</h6>
          <div id="mealContents"></div>
          <input id="mealContentAddSection" style="margin-top: 10px;" type="text" class="form-control" placeholder="Add Food">
          <div style="margin-top: 20px; margin-bottom: 15px; display: inline-block;">
            <h6 id="mealCost" style="display: inline-block; margin-right: 5px; vertical-align: top; margin-top: 5px;">Total Cost: $2.99</h6>
          </div>
        </div>
        <div class="modal-footer" style="">
          <div id="mealSave" class="btn btn-sm btn-success" style="float: right;">Save</div>
          <div id="mealDelete" class="btn btn-sm btn-danger" style="float: right;">Delete</div>
        </div>
      </div>
    </div>
  </div>

  <div id="editModal" class="modal fade in" role="dialog" style="overflow-x: scroll; overflow-y: hidden">
    <div class="modal-dialog" style="min-width: 300px; margin-top: 15px; overflow-y: initial !important;">
      <div class="modal-content">
        <div class="modal-header" style="">
          <h5 style="margin-top: 0px; margin-bottom: 0px; float: left;">Add or Eat Food</h5>
          <span class="icon-remove" style="float: right; font-size: 22px;" data-dismiss="modal"></span>
        </div>
        <div class="modal-body" style="width: 100%; margin-bottom: 0px; overflow-y: scroll; max-height: 570px; font-size: 15px; user-select: text;">
          <input id="editLookUp" class="form-control" placeholder="Look Up Food / Meal" style="display: inline-block; width: 100%; height: 40px; margin-right: 5px; margin-bottom: 5px;">
          <div id="editList" style="min-height: 150px;">
            <div style="background-color: lightgrey; padding: 5px; margin-top: 10px; border-radius: 5px;">
              <input class="form-control" style="display: inline-block; width: 80px; height: 35px; margin-right: 5px;" type="number">
              <h6 style="display: inline-block;">Name</h6>
              <span class="icon-remove" style="float: right; font-size: 20px; margin-top: 5px; margin-right: 10px; margin-left: 5px;"></span>
            </div>
            <div style="background-color: lightgrey; padding: 5px; margin-top: 10px; border-radius: 5px;">
              <input class="form-control" style="display: inline-block; width: 80px; height: 35px; margin-right: 5px;" type="number">
              <h6 style="display: inline-block;">Name</h6>
              <span class="icon-remove" style="float: right; font-size: 20px; margin-top: 5px; margin-right: 10px; margin-left: 5px;"></span>
            </div>
          </div>
        </div>
        <div class="modal-footer" style="text-align: left; display: inline-block;">
          <div class="btn-group" role="group" style="">
            <button type="button" data-type="add" class="btn btn-sm editMode">Add</button>
            <button type="button" data-type="remove" class="btn btn-sm editMode">Eat</button>
          </div>
          <div id="editSubmit" class="btn btn-sm btn-primary" style="float: right;">Save</div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>